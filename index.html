<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>AI-Generated Detector • Hexo</title><meta name="description" content="AI-Generated Detector - John Doe"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Hexo"><meta name="generator" content="Hexo 8.1.1"></head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="Hexo"><img class="logo-image" src="/logo.svg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">AI-Generated Detector</h1><div class="post-content">
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jokerface</title>
  <style>
    :root{
      --bg:#0b0f16; --panel:#0f1624; --panel2:#121b2b;
      --text:#e8eefc; --muted:#a7b4d6; --line:rgba(255,255,255,.08);
      --btn:#1f6feb; --btn2:#2b3348;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang SC","Microsoft YaHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 30% 20%, rgba(62,106,255,.18), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(0,255,200,.10), transparent 55%),
        var(--bg);
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{width:min(980px, 100%);}
    .top{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:14px;}
    h1{margin:0; font-size:34px; letter-spacing:.3px}
    .hint{color:var(--muted); font-size:14px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:24px;
      padding:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    .uploader{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
      padding:14px; border-radius:18px;
      background: rgba(0,0,0,.20);
      border:1px dashed rgba(255,255,255,.14);
    }
    .drop{
      width:120px; height:90px; border-radius:14px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      display:grid; place-items:center;
      color:var(--muted); font-size:12px;
      overflow:hidden;
    }
    .drop img{width:100%; height:100%; object-fit:cover; display:none;}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap; flex:1;}
    input[type=file]{color:var(--muted)}
    button{
      border:0; cursor:pointer;
      padding:10px 14px; border-radius:12px;
      font-weight:700;
      color:var(--text);
      background: var(--btn);
    }
    button.secondary{background:var(--btn2); border:1px solid var(--line); font-weight:600}
    button:disabled{opacity:.5; cursor:not-allowed}
    .chat{margin-top:14px; display:flex; flex-direction:column; gap:12px;}
    .row{display:flex; gap:12px;}
    .row.you{justify-content:flex-end}
    .bubble{
      max-width: min(760px, 100%);
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:12px 12px 10px;
    }
    .bubble .meta{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;}
    .name{font-weight:800; font-size:13px; color:var(--muted)}
    .copy{
      padding:6px 10px; border-radius:10px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      font-weight:700; font-size:12px;
    }
    pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.06);
      padding:10px;
      border-radius:14px;
      color: #dbe7ff;
      font-size:13px;
      line-height:1.4;
    }
    .foot{margin-top:10px; color:var(--muted); font-size:12px;}
    a{color:#9cc1ff}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background: rgba(255,255,255,.05);
      color:var(--muted); font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div style="display:flex; align-items:center; gap:12px;">
        <img
          src="/assets/jokerface.png"
          alt="Jokerface"
          style="width:100px;height:100px;border-radius:12px;object-fit:cover;"
        />
        <div>
          <h1 style="margin:0;">Jokerface</h1>
          <div class="hint">One-shot analysis · no history saved</div>
        </div>
      </div>
      <div class="pill" id="apiPill">API: <span id="apiState">checking...</span></div>
    </div>

    <div class="card">
      <div class="uploader" id="dropzone">
        <div class="drop">
          <span id="noimg">No image</span>
          <img id="preview" alt="preview" />
        </div>

        <div class="controls">
          <input id="file" type="file" accept="image/*" />
          <button id="btn" disabled>Analyze</button>
          <button class="secondary" id="reset">Reset</button>
          <span class="hint" id="status">Status: waiting</span>
        </div>
      </div>

      <div class="chat" id="chat"></div>

      <div class="foot">
        Website: <span class="hint" id="apiBaseText"></span>
        E-mail: zg2353607864@gmail.com
      </div>
    </div>
  </div>

<script>
  // ✅ 你的 Zeabur API 域名
  const API_BASE = "https://jokerface-api.zeabur.app";
  const ANALYZE_PATH = "/api/analyze";
  const HEALTHZ_PATH = "/healthz";

  // 超时（ms）：避免“卡住 -> Failed to fetch”无法定位
  const REQUEST_TIMEOUT_MS = 60_000;

  const fileEl = document.getElementById("file");
  const btn = document.getElementById("btn");
  const resetBtn = document.getElementById("reset");
  const chat = document.getElementById("chat");
  const statusEl = document.getElementById("status");
  const preview = document.getElementById("preview");
  const noimg = document.getElementById("noimg");
  const dropzone = document.getElementById("dropzone");
  const apiState = document.getElementById("apiState");
  const apiBaseText = document.getElementById("apiBaseText");

  apiBaseText.textContent = API_BASE;

  let currentFile = null;

  function addBubble(who, name, obj, withCopy=true){
    const row = document.createElement("div");
    row.className = "row " + (who === "you" ? "you" : "bot");

    const bubble = document.createElement("div");
    bubble.className = "bubble";

    const meta = document.createElement("div");
    meta.className = "meta";

    const n = document.createElement("div");
    n.className = "name";
    n.textContent = name;

    meta.appendChild(n);

    if(withCopy){
      const c = document.createElement("button");
      c.className = "copy";
      c.textContent = "Copy";
      c.onclick = async () => {
        await navigator.clipboard.writeText(JSON.stringify(obj, null, 2));
        c.textContent = "Copied";
        setTimeout(()=>c.textContent="Copy", 900);
      };
      meta.appendChild(c);
    }

    const pre = document.createElement("pre");
    pre.textContent = JSON.stringify(obj, null, 2);

    bubble.appendChild(meta);
    bubble.appendChild(pre);
    row.appendChild(bubble);
    chat.appendChild(row);
  }

  function setPreview(file){
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
    noimg.style.display = "none";
  }

  function setBusy(isBusy){
    btn.disabled = isBusy || !currentFile;
    fileEl.disabled = isBusy;
    resetBtn.disabled = isBusy;
  }

  function clearAll(){
    chat.innerHTML = "";
    fileEl.value = "";
    currentFile = null;
    btn.disabled = true;
    preview.style.display = "none";
    noimg.style.display = "block";
    statusEl.textContent = "Status: waiting";
  }

  function prettyHintFromErrorMessage(msg){
    const s = String(msg || "").toLowerCase();
    if (s.includes("timeout") || s.includes("aborted")) {
      return "可能是上传/推理超时：检查文件大小、后端处理耗时，或提高超时阈值。";
    }
    if (s.includes("failed to fetch")) {
      return "浏览器网络层失败：常见原因是请求被中断/被扩展拦截/代理问题。请打开 DevTools→Network 看是否有请求发出。";
    }
    if (s.includes("mixed content")) {
      return "混合内容：页面是 https，但请求走了 http。请确保 API_BASE 是 https。";
    }
    return "请打开 DevTools→Network，查看该请求的 Status/Type/Response（以及是否有 OPTIONS 预检）。";
  }

  // ✅ 核心：带超时的 fetch
  async function fetchWithTimeout(url, options={}, timeoutMs=REQUEST_TIMEOUT_MS){
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(new Error("timeout")), timeoutMs);

    try {
      const res = await fetch(url, {
        ...options,
        signal: controller.signal,
        cache: "no-store",
        credentials: "omit",
      });
      return res;
    } finally {
      clearTimeout(id);
    }
  }

  // ✅ 调后端 API（上传 FormData；不要手动设置 Content-Type）
  async function analyzeRemote(file){
    const url = `${API_BASE}${ANALYZE_PATH}`;

    const fd = new FormData();
    // 显式带 filename（更稳）
    fd.append("file", file, file.name);

    const r = await fetchWithTimeout(url, {
      method: "POST",
      body: fd,
    });

    const text = await r.text();
    let data;
    try { data = text ? JSON.parse(text) : {}; }
    catch { data = { error: "Non-JSON response", raw: text.slice(0, 1200) }; }

    if (!r.ok) {
      const msg = data?.error || `HTTP ${r.status}`;
      const err = new Error(msg);
      err.http_status = r.status;
      err.url = url;
      err.payload = data;
      throw err;
    }
    return data;
  }

  // 文件选择
  fileEl.addEventListener("change", () => {
    const f = fileEl.files?.[0];
    if(!f) return;
    currentFile = f;
    setPreview(f);
    btn.disabled = false;
    statusEl.textContent = "Status: ready";
    addBubble("you", "You", { filename: f.name, bytes: f.size, type: f.type }, false);
  });

  // 点击分析
  btn.onclick = async () => {
    if(!currentFile) return;

    setBusy(true);
    statusEl.textContent = "Status: analyzing...";

    const analyzeUrl = `${API_BASE}${ANALYZE_PATH}`;

    try{
      const result = await analyzeRemote(currentFile);
      addBubble("bot", "Jokerface", result, true);
      statusEl.textContent = "Status: done";
    }catch(e){
      const msg = String(e?.message || e);

      addBubble("bot", "Jokerface", {
        error: msg,
        name: e?.name || "Error",
        http_status: e?.http_status ?? null,
        request_url: e?.url || analyzeUrl,
        hint: prettyHintFromErrorMessage(msg),
        api_base: API_BASE
      }, true);

      statusEl.textContent = "Status: error";
    }finally{
      setBusy(false);
    }
  };

  resetBtn.onclick = clearAll;

  // 拖拽上传
  dropzone.addEventListener("dragover", (e)=>{ e.preventDefault(); });
  dropzone.addEventListener("drop", (e)=>{
    e.preventDefault();
    const f = e.dataTransfer.files?.[0];
    if(!f) return;
    const dt = new DataTransfer();
    dt.items.add(f);
    fileEl.files = dt.files;
    fileEl.dispatchEvent(new Event("change"));
  });

  // 全局兜底：把未捕获错误也显示出来（避免“看起来像没反应”）
  window.addEventListener("unhandledrejection", (ev) => {
    addBubble("bot", "Jokerface", {
      error: "Unhandled rejection",
      detail: String(ev.reason?.message || ev.reason || ""),
      hint: "请打开 DevTools→Console 看完整堆栈，并检查 Network 是否发出请求。"
    }, true);
  });

  // ✅ 启动时检查 API 可达性：必须 JSON 且 ok:true
  (async ()=>{
    const url = `${API_BASE}${HEALTHZ_PATH}`;
    try{
      const r = await fetchWithTimeout(url, { method: "GET" }, 8_000);
      const text = await r.text();
      let data = {};
      try { data = text ? JSON.parse(text) : {}; } catch {}

      if(!r.ok || data?.ok !== true) throw new Error("healthz not ok");
      apiState.textContent = "OK";
    }catch{
      apiState.textContent = "DOWN";
    }
  })();
</script>
</body>
</html>
</div></article></div></main><footer><div class="copyright"><p>&copy; 2026 <a href="http://example.com">John Doe</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>