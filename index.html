<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title> • Hexo</title><meta name="description" content=" - John Doe"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Hexo"><meta name="generator" content="Hexo 8.1.1"></head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="Hexo"><img class="logo-image" src="/logo.svg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">(untitled)</h1><div class="post-content"><!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jokerface</title>
  <style>
    :root{
      --bg:#0b0f19;
      --panel:rgba(255,255,255,0.06);
      --panel2:rgba(255,255,255,0.09);
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.62);
      --border:rgba(255,255,255,0.12);
      --shadow:0 18px 60px rgba(0,0,0,0.45);
      --r:18px;
      --accent:rgba(120,170,255,0.22);
      --accentBorder:rgba(120,170,255,0.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(800px 420px at 50% 0%, rgba(80,120,255,0.18), transparent 55%),
        radial-gradient(700px 520px at 20% 80%, rgba(0,200,160,0.10), transparent 55%),
        var(--bg);
      display:grid;
      place-items:center;
      padding:28px 16px;
    }
    .wrap{width:min(920px,100%)}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;gap:12px}
    .brand{font-weight:780;letter-spacing:.2px}
    .hint{color:var(--muted);font-size:13px}

    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .hero{padding:20px 18px 12px;border-bottom:1px solid var(--border)}
    h1{margin:0;font-size:26px;letter-spacing:-.2px}
    .sub{margin:8px 0 0;color:var(--muted);font-size:14px;line-height:1.5}

    .drop{
      margin:16px 18px 10px;
      border-radius:16px;
      border:1px dashed rgba(255,255,255,0.18);
      background:rgba(255,255,255,0.04);
      padding:16px;
      display:grid;
      gap:12px;
      transition:.18s ease;
    }
    .drop.dragover{
      border-color:rgba(120,170,255,0.65);
      background:rgba(120,170,255,0.10);
      transform: translateY(-1px);
    }
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .left{display:flex;gap:10px;align-items:center}
    .pill{
      font-size:12px;color:var(--muted);
      border:1px solid var(--border);
      background:rgba(255,255,255,0.04);
      padding:6px 10px;border-radius:999px;
      user-select:none;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(255,255,255,0.10);
      color:var(--text);
      padding:10px 12px;border-radius:12px;
      cursor:pointer;font-weight:650;
      transition:.15s ease;
      display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{background:rgba(255,255,255,0.14)}
    .btn.primary{
      border-color:var(--accentBorder);
      background:var(--accent);
    }
    .btn.primary:hover{background:rgba(120,170,255,0.28)}
    .btn.ghost{
      border-color:rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.18);
    }
    input[type="file"]{display:none}

    .preview{
      display:grid;
      grid-template-columns:88px 1fr;
      gap:12px;
      align-items:center;
    }
    .thumb{
      width:88px;height:88px;border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.06);
      overflow:hidden;
      display:grid;place-items:center;
      color:var(--muted);font-size:12px;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:none}
    .meta{color:var(--muted);font-size:13px;line-height:1.5}
    .meta b{color:var(--text)}

    /* chat-like area */
    .chat{
      padding: 4px 18px 18px;
      display:grid;
      gap: 10px;
    }
    .bubble{
      max-width: 100%;
      border:1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding: 12px 12px;
      background: rgba(0,0,0,0.22);
    }
    .bubble.user{
      justify-self:end;
      background: rgba(255,255,255,0.08);
    }
    .bubble.assistant{
      justify-self:start;
      background: rgba(0,0,0,0.32);
    }
    .bubble .head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
      color: var(--muted);
      font-size: 12px;
    }
    pre{
      margin:0;
      padding:12px;
      border-radius:14px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.86);
      overflow:auto;
      max-height: 320px;
      font-size: 12.5px;
      line-height: 1.45;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.65);
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px 12px;
      border-radius: 12px;
      color: rgba(255,255,255,0.85);
      font-size: 13px;
      display:none;
      backdrop-filter: blur(8px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">Jokerface</div>
      <div class="hint">No history saved · One-shot analysis</div>
    </div>

    <div class="panel">
      <div class="hero">
        <h1>Analyze image</h1>
        <div class="sub">上传一张图片 → 点击 Analyze → 后端跑一个简单算法 → 结果以对话框展示，可一键复制。</div>
      </div>

      <div id="drop" class="drop">
        <div class="row">
          <div class="left">
            <span class="pill">PNG / JPG / WEBP</span>
            <span class="pill">No storage</span>
          </div>
          <div style="display:flex; gap:10px; align-items:center;">
            <label class="btn" for="file">Choose file</label>
            <input id="file" type="file" accept="image/*" />
            <button id="btn" class="btn primary">Analyze</button>
          </div>
        </div>

        <div class="preview">
          <div class="thumb">
            <img id="thumb" alt="preview" />
            <span id="thumbText">No image</span>
          </div>
          <div class="meta" id="meta">
            <div><b>Status:</b> waiting</div>
            <div>Drop an image here or click “Choose file”.</div>
          </div>
        </div>
      </div>

      <div class="chat" id="chat">
        <!-- bubbles inserted here -->
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Copied</div>

  <script>
    // 改成你 Zeabur 上 Node API 的域名
    const API_BASE = "https://jokerface-api.zeabur.app";

    const fileEl = document.getElementById("file");
    const drop = document.getElementById("drop");
    const meta = document.getElementById("meta");
    const thumb = document.getElementById("thumb");
    const thumbText = document.getElementById("thumbText");
    const chat = document.getElementById("chat");
    const toast = document.getElementById("toast");

    let currentFile = null;

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (c)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[c]));
    }
    function showToast(msg="Copied"){
      toast.textContent = msg;
      toast.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.style.display="none", 900);
    }
    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        showToast("Copied");
      }catch{
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        showToast("Copied");
      }
    }

    function resetUI(){
      meta.innerHTML = `<div><b>Status:</b> waiting</div><div>Drop an image here or click “Choose file”.</div>`;
      thumb.style.display = "none";
      thumbText.style.display = "block";
      thumbText.textContent = "No image";
      currentFile = null;
      chat.innerHTML = "";
    }

    function setFile(f){
      currentFile = f;
      const url = URL.createObjectURL(f);
      thumb.src = url;
      thumb.style.display = "block";
      thumbText.style.display = "none";

      meta.innerHTML = `
        <div><b>Selected:</b> ${escapeHtml(f.name)}</div>
        <div>${Math.round(f.size/1024)} KB · ${escapeHtml(f.type || "image/*")}</div>
      `;

      // user bubble
      chat.innerHTML = "";
      addBubble("user", "You", {
        filename: f.name,
        bytes: f.size,
        type: f.type
      }, false);
    }

    function addBubble(role, who, obj, withCopy=true){
      const bubble = document.createElement("div");
      bubble.className = `bubble ${role}`;

      const jsonText = (typeof obj === "string") ? obj : JSON.stringify(obj, null, 2);

      const head = document.createElement("div");
      head.className = "head";
      head.innerHTML = `<span>${escapeHtml(who)}</span>`;

      if(withCopy){
        const copyBtn = document.createElement("button");
        copyBtn.className = "btn ghost";
        copyBtn.textContent = "Copy";
        copyBtn.onclick = () => copyText(jsonText);
        head.appendChild(copyBtn);
      }

      const pre = document.createElement("pre");
      pre.textContent = jsonText;

      bubble.appendChild(head);
      bubble.appendChild(pre);
      chat.appendChild(bubble);
      bubble.scrollIntoView({ behavior: "smooth", block: "end" });
    }

    fileEl.addEventListener("change", ()=>{
      const f = fileEl.files?.[0];
      if(f) setFile(f);
    });

    // drag & drop
    ["dragenter","dragover"].forEach(evt=>{
      drop.addEventListener(evt, e=>{
        e.preventDefault(); e.stopPropagation();
        drop.classList.add("dragover");
      });
    });
    ["dragleave","drop"].forEach(evt=>{
      drop.addEventListener(evt, e=>{
        e.preventDefault(); e.stopPropagation();
        drop.classList.remove("dragover");
      });
    });
    drop.addEventListener("drop",(e)=>{
      const f = e.dataTransfer?.files?.[0];
      if(f) setFile(f);
    });

    document.getElementById("btn").onclick = async ()=>{
      if(!currentFile) return alert("请先选择图片或拖拽图片进来");

      meta.innerHTML = `<div><b>Status:</b> analyzing...</div><div>Please wait.</div>`;

      const fd = new FormData();
      fd.append("file", currentFile);

      try{
          const r = await fetch(`${API_BASE}/api/analyze`, { method:"POST", body: fd });

          const text = await r.text(); // 先拿原始文本
          let j;
          try {
            j = text ? JSON.parse(text) : { error: "Empty response body" };
          } catch {
            j = { error: "Non-JSON response", status: r.status, body_preview: text.slice(0, 300) };
          }

          if (!r.ok) {
            addBubble("assistant", "Jokerface", j, true);
            meta.innerHTML = `<div><b>Status:</b> error</div><div>HTTP ${r.status}</div>`;
            return;
          }

          addBubble("assistant", "Jokerface", j, true);


        if(!r.ok){
          addBubble("assistant", "Jokerface", { error: j.error || "Request failed" });
          meta.innerHTML = `<div><b>Status:</b> error</div><div>${escapeHtml(j.error || "Request failed")}</div>`;
          return;
        }

        addBubble("assistant", "Jokerface", j, true);
        meta.innerHTML = `<div><b>Status:</b> done</div><div>${escapeHtml(j.summary || "OK")}</div>`;
      }catch(e){
        addBubble("assistant", "Jokerface", { error: String(e?.message || e) }, true);
        meta.innerHTML = `<div><b>Status:</b> error</div><div>${escapeHtml(String(e?.message || e))}</div>`;
      }
    };

    resetUI();
  </script>
</body>
</html>
</div></article></div></main><footer><div class="copyright"><p>&copy; 2026 <a href="http://example.com">John Doe</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>