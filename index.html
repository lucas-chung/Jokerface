<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title> • Hexo</title><meta name="description" content=" - John Doe"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Hexo"><meta name="generator" content="Hexo 8.1.1"></head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="Hexo"><img class="logo-image" src="/logo.svg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">(untitled)</h1><div class="post-content"><!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jokerface</title>
  <style>
    :root{
      --bg:#0b0f16; --panel:#0f1624; --panel2:#121b2b;
      --text:#e8eefc; --muted:#a7b4d6; --line:rgba(255,255,255,.08);
      --btn:#1f6feb; --btn2:#2b3348;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang SC","Microsoft YaHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 30% 20%, rgba(62,106,255,.18), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(0,255,200,.10), transparent 55%),
        var(--bg);
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{width:min(980px, 100%);}
    .top{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:14px;}
    h1{margin:0; font-size:34px; letter-spacing:.3px}
    .hint{color:var(--muted); font-size:14px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:24px;
      padding:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    .uploader{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
      padding:14px; border-radius:18px;
      background: rgba(0,0,0,.20);
      border:1px dashed rgba(255,255,255,.14);
    }
    .drop{
      width:120px; height:90px; border-radius:14px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      display:grid; place-items:center;
      color:var(--muted); font-size:12px;
      overflow:hidden;
    }
    .drop img{width:100%; height:100%; object-fit:cover; display:none;}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap; flex:1;}
    input[type=file]{color:var(--muted)}
    button{
      border:0; cursor:pointer;
      padding:10px 14px; border-radius:12px;
      font-weight:700;
      color:var(--text);
      background: var(--btn);
    }
    button.secondary{background:var(--btn2); border:1px solid var(--line); font-weight:600}
    button:disabled{opacity:.5; cursor:not-allowed}
    .chat{margin-top:14px; display:flex; flex-direction:column; gap:12px;}
    .row{display:flex; gap:12px;}
    .row.you{justify-content:flex-end}
    .bubble{
      max-width: min(760px, 100%);
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:12px 12px 10px;
    }
    .bubble .meta{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;}
    .name{font-weight:800; font-size:13px; color:var(--muted)}
    .copy{
      padding:6px 10px; border-radius:10px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      font-weight:700; font-size:12px;
    }
    pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.06);
      padding:10px;
      border-radius:14px;
      color: #dbe7ff;
      font-size:13px;
      line-height:1.4;
    }
    .foot{margin-top:10px; color:var(--muted); font-size:12px;}
    a{color:#9cc1ff}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background: rgba(255,255,255,.05);
      color:var(--muted); font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>Jokerface</h1>
        <div class="hint">One-shot analysis · no history saved</div>
      </div>
      <div class="pill" id="apiPill">API: <span id="apiState">checking...</span></div>
    </div>

    <div class="card">
      <div class="uploader" id="dropzone">
        <div class="drop">
          <span id="noimg">No image</span>
          <img id="preview" alt="preview" />
        </div>

        <div class="controls">
          <input id="file" type="file" accept="image/*" />
          <button id="btn" disabled>Analyze</button>
          <button class="secondary" id="reset">Reset</button>
          <span class="hint" id="status">Status: waiting</span>
        </div>
      </div>

      <div class="chat" id="chat"></div>

      <div class="foot">
        后端接口：<span class="hint" id="apiBaseText"></span>
        · 若报错，把 Jokerface 气泡里的 error 复制给我即可定位。
      </div>
    </div>
  </div>

<script>
  // ✅ 你的 Zeabur API 域名（确认无误）
  const API_BASE = "https://jokerface-api.zeabur.app";

  const fileEl = document.getElementById("file");
  const btn = document.getElementById("btn");
  const resetBtn = document.getElementById("reset");
  const chat = document.getElementById("chat");
  const statusEl = document.getElementById("status");
  const preview = document.getElementById("preview");
  const noimg = document.getElementById("noimg");
  const dropzone = document.getElementById("dropzone");
  const apiState = document.getElementById("apiState");
  const apiBaseText = document.getElementById("apiBaseText");

  apiBaseText.textContent = API_BASE;

  let currentFile = null;

  function addBubble(who, name, obj, withCopy=true){
    const row = document.createElement("div");
    row.className = "row " + (who === "you" ? "you" : "bot");

    const bubble = document.createElement("div");
    bubble.className = "bubble";

    const meta = document.createElement("div");
    meta.className = "meta";

    const n = document.createElement("div");
    n.className = "name";
    n.textContent = name;

    meta.appendChild(n);

    if(withCopy){
      const c = document.createElement("button");
      c.className = "copy";
      c.textContent = "Copy";
      c.onclick = async () => {
        await navigator.clipboard.writeText(JSON.stringify(obj, null, 2));
        c.textContent = "Copied";
        setTimeout(()=>c.textContent="Copy", 900);
      };
      meta.appendChild(c);
    }

    const pre = document.createElement("pre");
    pre.textContent = JSON.stringify(obj, null, 2);

    bubble.appendChild(meta);
    bubble.appendChild(pre);
    row.appendChild(bubble);
    chat.appendChild(row);
  }

  function setPreview(file){
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
    noimg.style.display = "none";
  }

  function clearAll(){
    chat.innerHTML = "";
    fileEl.value = "";
    currentFile = null;
    btn.disabled = true;
    preview.style.display = "none";
    noimg.style.display = "block";
    statusEl.textContent = "Status: waiting";
  }

  // ✅ 调后端 API
  async function analyzeRemote(file){
    const fd = new FormData();
    fd.append("file", file);

    const r = await fetch(`${API_BASE}/api/analyze`, {
      method: "POST",
      body: fd,
    });

    // 兜底：避免 “Unexpected end of JSON input”
    const text = await r.text();
    let data;
    try { data = text ? JSON.parse(text) : {}; }
    catch { data = { error: "Non-JSON response", raw: text.slice(0, 800) }; }

    if (!r.ok) {
      throw new Error(data?.error || `HTTP ${r.status}`);
    }
    return data;
  }

  fileEl.addEventListener("change", () => {
    const f = fileEl.files?.[0];
    if(!f) return;
    currentFile = f;
    setPreview(f);
    btn.disabled = false;
    statusEl.textContent = "Status: ready";
    addBubble("you", "You", { filename: f.name, bytes: f.size, type: f.type }, false);
  });

  btn.onclick = async () => {
    if(!currentFile) return;

    btn.disabled = true;
    statusEl.textContent = "Status: analyzing...";

    try{
      const result = await analyzeRemote(currentFile);
      addBubble("bot", "Jokerface", result, true);
      statusEl.textContent = "Status: done";
    }catch(e){
      addBubble("bot", "Jokerface", {
        error: String(e?.message || e),
        hint: "Check: API healthz, domain, CORS, or Zeabur 502",
        api_base: API_BASE
      }, true);
      statusEl.textContent = "Status: error";
    }finally{
      btn.disabled = false;
    }
  };

  resetBtn.onclick = clearAll;

  // 拖拽上传
  dropzone.addEventListener("dragover", (e)=>{ e.preventDefault(); });
  dropzone.addEventListener("drop", (e)=>{
    e.preventDefault();
    const f = e.dataTransfer.files?.[0];
    if(!f) return;
    const dt = new DataTransfer();
    dt.items.add(f);
    fileEl.files = dt.files;
    fileEl.dispatchEvent(new Event("change"));
  });

  // ✅ 启动时检查 API 可达性（可选但很实用）
  (async ()=>{
    try{
      const r = await fetch(`${API_BASE}/healthz`, { method: "GET" });
      if(!r.ok) throw new Error("healthz not ok");
      apiState.textContent = "OK";
    }catch{
      apiState.textContent = "DOWN";
    }
  })();
</script>
</body>
</html>
</div></article></div></main><footer><div class="copyright"><p>&copy; 2026 <a href="http://example.com">John Doe</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>